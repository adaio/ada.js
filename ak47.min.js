var ak47=function(undefined){function ak47(){var args=Array.prototype.slice.call(arguments),fn;return args.length==1&&typeof args[0]=="object"&&args[0].constructor==Object?fn=newObject:args.length>1&&args.slice(0,args.length-2).every(isObservable)&&typeof args[args.length-2]=="function"&&typeof args[args.length-1]=="function"?fn=subscribeTo:args.length==1&&Array.isArray(args[0])?fn=pubsub:args.length?(fn=property,args=args.slice(0,1)):fn=pubsub,fn.apply(undefined,args)}function isObservable(el){return el&&el.extendsAk47Pubsub}function newObject(raw,exceptions){var obj={},key,val;for(key in raw)val=raw[key],obj[key]=!(!Array.isArray(exceptions)||!key in exceptions)||typeof val=="object"&&val.constructor==Object||typeof val=="function"?val:property(val);return obj}function publish(from){if(from&&from.subscribers&&from.subscribers.length==0)return;var args=Array.prototype.slice.call(arguments,1),newValue,oldValue;from.subscribers.forEach(function(cb,i){if(!cb||typeof cb.callback!="function")return;if(!cb.isAk47Subscriber){try{cb.callback.apply(undefined,args)}catch(exc){setTimeout(function(){throw exc},0)}return}from.extendsAk47Pubsub&&!from.hasCustomProxy&&args.length>1?Array.prototype.splice.apply(cb.harvest,[cb.column,args.length].concat(args)):cb.harvest[cb.column]=args[0],oldValue=cb.harvest.value;if(!cb.batch()){cb.getter?(newValue=cb.harvest.value=cb.getter.apply(undefined,cb.harvest),cb.pubsub.publish(newValue,oldValue)):cb.pubsub.publish.apply(undefined,cb.harvest);return}cb.harvest.call!=undefined&&(clearTimeout(cb.harvest.call),cb.call=undefined),cb.harvest.call=setTimeout(function(){cb.getter?(newValue=cb.harvest.value=cb.getter.apply(undefined,cb.harvest),cb.harvest.call=undefined,cb.pubsub.publish(newValue,oldValue)):cb.pubsub.publish.apply(undefined,cb.harvest)},0)})}function pubsub(customProxy){function sub(callback){subscribe(proxy,callback)}function unsub(callback){unsubscribe(proxy,callback)}function pub(){var args=[proxy];Array.prototype.push.apply(args,arguments),publish.apply(undefined,args)}var proxy=customProxy||function pubsubProxy(){arguments.length&&sub.apply(undefined,arguments)};return proxy.subscribers=[],proxy.subscribe=sub,proxy.unsubscribe=unsub,proxy.publish=pub,proxy.extendsAk47Pubsub=!0,proxy.hasCustomProxy=!!customProxy,proxy}function property(rawValue,getter,setter){function get(){return getter?getter(value):value}function propertyProxy(update){return arguments.length>0&&set(update),get()}function raw(update){return arguments.length&&(value=update),value}function set(update,options){var old=!options||!options.skipPublishing?get():undefined;return value=setter?setter(update,value):update,(!options||!options.skipPublishing)&&publish(proxy,get(),old),value}var value=undefined,proxy=propertyProxy;return pubsub(proxy),proxy.isAK47Property=!0,proxy.raw=raw,proxy.publish=function publishProperty(){var args=[proxy,get()].concat(Array.prototype.slice.call(arguments));return publish.apply(undefined,args)},set(rawValue,{skipPublishing:!0}),proxy}function subscribe(to,callback){if(!callback)throw new Error("Invalid callback: "+callback);to.subscribers.push(typeof callback=="function"?{callback:callback}:callback)}function subscribeTo(){function accessor(){return arguments.length?setter.apply(undefined,arguments):getter.apply(undefined,harvest)}function loop(){var i=-1,col=harvest.length,to=arguments,prop;while(++i<to.length)prop=to[i],harvest[col+i]=prop.isAK47Property?prop():undefined,prop.subscribe({isAk47Subscriber:!0,callback:callback,getter:getter,setter:setter,pubsub:proxy,harvest:harvest,column:col+i,batch:toBatch})}function toBatch(){return batch}var harvest=[],setter=arguments.length<3||isObservable(arguments[arguments.length-2])?undefined:arguments[arguments.length-1],subscriber=arguments[arguments.length-(setter?2:1)],batch=!0,proxy,callback,getter;return subscriber.extendsAk47Pubsub?(proxy=subscriber,getter=undefined,callback=subscriber.publish):(proxy=pubsub(accessor),getter=subscriber,callback=subscriber),proxy.harvest=harvest,proxy.subscribeTo=loop,proxy.getter=function(){return getter=arguments[0],proxy},proxy.setter=function(){return setter=arguments[0],proxy},proxy.sync=function sync(){return batch=!1,proxy},proxy.isAK47Property=!0,loop.apply(null,Array.prototype.slice.call(arguments,0,arguments.length-(setter?2:1))),proxy}function unsubscribe(to,callback){var callbacks=to.subscribers;callbacks[callbacks.indexOf(callback)]=undefined}var nextTick=typeof process!="undefined"&&process.nextTick||function nextTick(fn){return setTimeout(fn,0)};return ak47.pubsub=pubsub,ak47.property=property,ak47.subscribeTo=subscribeTo,ak47}();typeof module!="undefined"&&module.exports&&(module.exports=ak47);