var ak47=function(undefined){function ak47(){var args=Array.prototype.slice.call(arguments),fn;return args.length==1&&typeof args[0]=="object"&&args[0].constructor==Object?fn=newObject:args.length>1&&args.slice(0,args.length-2).every(isObservable)&&typeof args[args.length-2]=="function"&&typeof args[args.length-1]=="function"?fn=subscribeAll:args.length==1&&Array.isArray(args[0])?fn=pubsub:args.length?(fn=property,args=args.slice(0,1)):fn=pubsub,fn.apply(undefined,args)}function isObservable(el){return el&&el.extendsAk47Pubsub}function newObject(raw,exceptions){var obj={},key,val;for(key in raw)val=raw[key],obj[key]=!(!Array.isArray(exceptions)||!key in exceptions)||typeof val=="object"&&val.constructor==Object||typeof val=="function"?val:property(val);return obj}function publish(from){if(from&&from.subscribers&&from.subscribers.length==0)return;var args=Array.prototype.slice.call(arguments,1),newValue,oldValue;from.subscribers.forEach(function(cb,i){if(!cb||typeof cb.fn!="function")return;if(!cb.ak47Subscriber){try{cb.fn.apply(undefined,args)}catch(exc){setTimeout(function(){throw exc},0)}return}cb.harvest[cb.column]=args[0];if(!cb.batch()){oldValue=cb.harvest.value;try{newValue=cb.fn.apply(undefined,cb.harvest)}catch(exc){setTimeout(function(){throw exc},0);return}cb.harvest.value=newValue,cb.property.publish(cb.harvest.value,oldValue);return}cb.harvest.call!=undefined&&(clearTimeout(cb.harvest.call),cb.call=undefined),cb.harvest.call=setTimeout(function(){cb.harvest.call=undefined,oldValue=cb.harvest.value;try{newValue=cb.fn.apply(undefined,cb.harvest)}catch(exc){setTimeout(function(){throw exc},0);return}cb.harvest.value=newValue,cb.property.publish(cb.harvest.value,oldValue)},0)})}function pubsub(customProxy){function sub(callback){subscribe(proxy,callback)}function unsub(callback){unsubscribe(proxy,callback)}function pub(){var args=[proxy];Array.prototype.push.apply(args,arguments),publish.apply(undefined,args)}var proxy=customProxy||function proxy(){return sub.apply(undefined,arguments)};return proxy.subscribers=[],proxy.subscribe=sub,proxy.unsubscribe=unsub,proxy.publish=pub,proxy.extendsAk47Pubsub=!0,proxy}function property(rawValue,getter,setter){function get(){return getter?getter(value):value}function proxy(update){return arguments.length>0&&set(update),get()}function raw(update){return arguments.length&&(value=update),value}function set(update,options){var old=!options||!options.skipPublishing?get():undefined;return value=setter?setter(update,value):update,(!options||!options.skipPublishing)&&publish(proxy,get(),old),value}var value=undefined;return pubsub(proxy),proxy.isAK47Property=!0,proxy.raw=raw,proxy.publish=function publishProperty(){var args=[proxy,get()].concat(Array.prototype.slice.call(arguments));return publish.apply(undefined,args)},set(rawValue,{skipPublishing:!0}),proxy}function subscribe(to,callback){to.subscribers.push(typeof callback=="function"?{fn:callback}:callback)}function subscribeAll(){function toBatch(){return batch}function proxy(){return arguments.length&&setter&&setter.apply(this,arguments),getter.apply(this,harvest)}var harvest=[],setter=isObservable(arguments[arguments.length-2])?undefined:arguments[arguments.length-1],getter=arguments[arguments.length-(setter?2:1)],to=Array.prototype.slice.call(arguments,0,arguments.length-(setter?2:1)),batch=!1,i=-1,property;while(++i<to.length)property=to[i],harvest[i]=typeof property=="function"?property():property,property.subscribe({fn:getter,property:proxy,ak47Subscriber:!0,harvest:harvest,column:i,batch:toBatch});return proxy.batch=function setBatch(){return batch=!0,proxy},proxy.setter=function(fn){return setter=fn,proxy},pubsub(proxy),proxy.isAK47Property=!0,proxy.raw=proxy,proxy}function unsubscribe(to,callback){var callbacks=to.subscribers;callbacks[callbacks.indexOf(callback)]=undefined}return ak47.pubsub=pubsub,ak47.property=property,ak47}();typeof module!="undefined"&&module.exports&&(module.exports=ak47);